---
source: tests/schema_snapshots.rs
expression: schema
---
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "AgentEvent",
  "description": "A timestamped event emitted by an agent during a run.\n\n# Examples\n\n```\nuse abp_core::{AgentEvent, AgentEventKind};\nuse chrono::Utc;\n\nlet event = AgentEvent {\n    ts: Utc::now(),\n    kind: AgentEventKind::AssistantMessage {\n        text: \"Hello, world!\".into(),\n    },\n    ext: None,\n};\nassert!(matches!(event.kind, AgentEventKind::AssistantMessage { .. }));\n```",
  "type": "object",
  "properties": {
    "ext": {
      "description": "Extension field for passthrough mode raw data.\n\nIn passthrough mode, this contains the original SDK message\nfor lossless reconstruction. The key `raw_message` contains\nthe verbatim SDK message.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": true
    },
    "ts": {
      "description": "Timestamp when the event was emitted.",
      "type": "string",
      "format": "date-time"
    }
  },
  "oneOf": [
    {
      "description": "The agent run has started.",
      "type": "object",
      "properties": {
        "message": {
          "description": "Human-readable start message.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "run_started"
        }
      },
      "required": [
        "type",
        "message"
      ]
    },
    {
      "description": "The agent run has completed.",
      "type": "object",
      "properties": {
        "message": {
          "description": "Human-readable completion message.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "run_completed"
        }
      },
      "required": [
        "type",
        "message"
      ]
    },
    {
      "description": "Incremental assistant text (streaming token).",
      "type": "object",
      "properties": {
        "text": {
          "description": "The text fragment.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "assistant_delta"
        }
      },
      "required": [
        "type",
        "text"
      ]
    },
    {
      "description": "Complete assistant message.",
      "type": "object",
      "properties": {
        "text": {
          "description": "The full message text.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "assistant_message"
        }
      },
      "required": [
        "type",
        "text"
      ]
    },
    {
      "description": "A tool invocation by the agent.",
      "type": "object",
      "properties": {
        "input": {
          "description": "JSON input passed to the tool."
        },
        "parent_tool_use_id": {
          "description": "Identifier of the parent tool use, if nested.",
          "type": [
            "string",
            "null"
          ]
        },
        "tool_name": {
          "description": "Name of the tool being called.",
          "type": "string"
        },
        "tool_use_id": {
          "description": "Unique identifier for this tool use.",
          "type": [
            "string",
            "null"
          ]
        },
        "type": {
          "type": "string",
          "const": "tool_call"
        }
      },
      "required": [
        "type",
        "tool_name",
        "input"
      ]
    },
    {
      "description": "Result returned from a tool invocation.",
      "type": "object",
      "properties": {
        "is_error": {
          "description": "Whether the tool reported an error.",
          "type": "boolean"
        },
        "output": {
          "description": "JSON output from the tool."
        },
        "tool_name": {
          "description": "Name of the tool that produced this result.",
          "type": "string"
        },
        "tool_use_id": {
          "description": "Identifier correlating to the originating tool call.",
          "type": [
            "string",
            "null"
          ]
        },
        "type": {
          "type": "string",
          "const": "tool_result"
        }
      },
      "required": [
        "type",
        "tool_name",
        "output",
        "is_error"
      ]
    },
    {
      "description": "A file was created or modified in the workspace.",
      "type": "object",
      "properties": {
        "path": {
          "description": "Path to the changed file (relative to workspace root).",
          "type": "string"
        },
        "summary": {
          "description": "Human-readable summary of the change.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "file_changed"
        }
      },
      "required": [
        "type",
        "path",
        "summary"
      ]
    },
    {
      "description": "A shell command was executed.",
      "type": "object",
      "properties": {
        "command": {
          "description": "The command that was run.",
          "type": "string"
        },
        "exit_code": {
          "description": "Process exit code, if available.",
          "type": [
            "integer",
            "null"
          ],
          "format": "int32"
        },
        "output_preview": {
          "description": "Truncated preview of the command output.",
          "type": [
            "string",
            "null"
          ]
        },
        "type": {
          "type": "string",
          "const": "command_executed"
        }
      },
      "required": [
        "type",
        "command"
      ]
    },
    {
      "description": "A non-fatal warning emitted during the run.",
      "type": "object",
      "properties": {
        "message": {
          "description": "Warning message text.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "warning"
        }
      },
      "required": [
        "type",
        "message"
      ]
    },
    {
      "description": "A fatal error emitted during the run.",
      "type": "object",
      "properties": {
        "error_code": {
          "description": "Machine-readable error code from the unified taxonomy, if available.",
          "anyOf": [
            {
              "$ref": "#/$defs/ErrorCode"
            },
            {
              "type": "null"
            }
          ]
        },
        "message": {
          "description": "Error message text.",
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "error"
        }
      },
      "required": [
        "type",
        "message"
      ]
    }
  ],
  "required": [
    "ts"
  ],
  "$defs": {
    "ErrorCode": {
      "description": "Machine-readable, stable error code.\n\nEach variant serialises to a `SCREAMING_SNAKE_CASE` string that is\nguaranteed not to change across patch releases.\n\n# Examples\n\n```\nuse abp_error::ErrorCode;\n\nlet code = ErrorCode::BackendTimeout;\nassert_eq!(code.as_str(), \"BACKEND_TIMEOUT\");\nassert_eq!(code.to_string(), \"BACKEND_TIMEOUT\");\nassert_eq!(code.category().to_string(), \"backend\");\n```",
      "oneOf": [
        {
          "description": "Envelope failed to parse or has missing/invalid fields.",
          "type": "string",
          "const": "PROTOCOL_INVALID_ENVELOPE"
        },
        {
          "description": "Message arrived in wrong order (e.g. event before hello).",
          "type": "string",
          "const": "PROTOCOL_UNEXPECTED_MESSAGE"
        },
        {
          "description": "Contract version mismatch between host and sidecar.",
          "type": "string",
          "const": "PROTOCOL_VERSION_MISMATCH"
        },
        {
          "description": "Requested backend name does not exist.",
          "type": "string",
          "const": "BACKEND_NOT_FOUND"
        },
        {
          "description": "Backend did not respond within the configured timeout.",
          "type": "string",
          "const": "BACKEND_TIMEOUT"
        },
        {
          "description": "Backend process exited unexpectedly.",
          "type": "string",
          "const": "BACKEND_CRASHED"
        },
        {
          "description": "A required capability is not supported by the backend.",
          "type": "string",
          "const": "CAPABILITY_UNSUPPORTED"
        },
        {
          "description": "Capability emulation layer failed.",
          "type": "string",
          "const": "CAPABILITY_EMULATION_FAILED"
        },
        {
          "description": "A policy rule denied the operation.",
          "type": "string",
          "const": "POLICY_DENIED"
        },
        {
          "description": "Policy definition itself is malformed.",
          "type": "string",
          "const": "POLICY_INVALID"
        },
        {
          "description": "Failed to initialise the staged workspace.",
          "type": "string",
          "const": "WORKSPACE_INIT_FAILED"
        },
        {
          "description": "Failed to copy / stage files into the workspace.",
          "type": "string",
          "const": "WORKSPACE_STAGING_FAILED"
        },
        {
          "description": "IR lowering (high-level â†’ wire) failed.",
          "type": "string",
          "const": "IR_LOWERING_FAILED"
        },
        {
          "description": "IR structure is invalid or inconsistent.",
          "type": "string",
          "const": "IR_INVALID"
        },
        {
          "description": "Computed receipt hash does not match the declared hash.",
          "type": "string",
          "const": "RECEIPT_HASH_MISMATCH"
        },
        {
          "description": "Receipt chain has a gap or out-of-order entry.",
          "type": "string",
          "const": "RECEIPT_CHAIN_BROKEN"
        },
        {
          "description": "Dialect identifier is not recognised.",
          "type": "string",
          "const": "DIALECT_UNKNOWN"
        },
        {
          "description": "Mapping between dialects failed.",
          "type": "string",
          "const": "DIALECT_MAPPING_FAILED"
        },
        {
          "description": "Configuration file or value is invalid.",
          "type": "string",
          "const": "CONFIG_INVALID"
        },
        {
          "description": "Catch-all for unexpected internal errors.",
          "type": "string",
          "const": "INTERNAL"
        }
      ]
    }
  }
}
